{% extends "base.html" %}
{% block title %}担当学生一覧{% endblock %}

{% block content %}
<div class="page-container">
  <div class="profile-card">

    <h2>{{ school_name }} - 担当学生一覧</h2>

    {% if students %}
      <table class="student-list-table">
        <thead>
          <tr>
            <th>学年</th>
            <th>氏名</th>
            <th>ポートフォリオ (3件まで)</th>
            <th>（学生詳細）</th>
            <th>（コメント編集）</th>
          </tr>
        </thead>
        <tbody>
          {% for student in students %}
            <tr>
              <td>{{ student.grade }}年</td>
              
              <td>
                <a href="{% url 'accounts:student_detail' student.pk %}">
                  {{ student.full_name }}
                </a>
              </td>
              
              <td>
                {% with portfolios=student.portfolio_set.all %}
                  {% if portfolios %}
                    <div class="portfolio-scroll-wrapper">
                      <ul>
                        {% for portfolio in portfolios|slice:":3" %}
                          <li>
                            <a href="{% url 'accounts:student_detail' student.pk %}">
                               {{ portfolio.title }}
                            </a>
                          </li>
                        {% endfor %}
                      </ul>
                    </div>
                    
                    {% if portfolios.count > 3 %}
                      <small>
                        ... (他 {{ portfolios.count|add:"-3" }} 件)
                      </small>
                    {% endif %}
                  {% else %}
                    （未作成）
                  {% endif %}
                {% endwith %}
              </td>
              
              <td>
                <a href="{% url 'accounts:student_detail' student.pk %}" class="detail-btn">
                  詳細を見る
                </a>
              </td>
              <td>
                <a href="{% url 'accounts:student_comment_update' student.pk %}" class="comment-btn">
                  コメント編集
                </a>
              </td>
            </tr>
          {% endfor %}
        </tbody>
      </table>
    {% else %}
      <p>所属する学生はまだ登録されていません。</p>
    {% endif %}
    
    <hr>
    <a href="{% url 'accounts:dashboard' %}" class="back-link">← メインメニューに戻る</a>

  </div>
</div>
{% endblock %}