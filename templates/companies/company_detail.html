{% extends "base.html" %}
{% block title %}{{ company.name }} ä¼æ¥­è©³ç´°{% endblock %}

{% block content %}
<div class="page-container">
  <div class="profile-card">

    <h2>{{ company.name }}</h2>

    {% if user.student and match_rate is not None %}
      <div style="margin-bottom: 20px; padding: 15px; background-color: #fff5f5; border: 2px solid #ff6b6b; border-radius: 10px; color: #c0392b; text-align: center;">
        <span style="font-size: 1.1rem;">ã‚ãªãŸã¨ã®ãƒãƒƒãƒåº¦</span><br>
        <span style="font-size: 2.5rem; font-weight: bold; line-height: 1.2;">{{ match_rate }}%</span>
      </div>
    {% endif %}

    {% if matched_strengths or matched_conditions %}
          <hr style="border-top: 1px dashed #ffcccc; margin: 15px 0;">
          <div style="text-align: left; font-size: 0.95rem;">
            
            {% if matched_strengths %}
              <div style="margin-bottom: 8px;">
                <strong style="color: #e53e3e;">âš¡ ãƒãƒƒãƒã—ãŸã‚¹ã‚­ãƒ«ãƒ»å¼·ã¿:</strong><br>
                {% for tag in matched_strengths %}
                  <span style="display: inline-block; background: #fff; border: 1px solid #fc8181; color: #c53030; padding: 2px 8px; border-radius: 15px; font-size: 0.85rem; margin: 2px;">
                    {{ tag }}
                  </span>
                {% endfor %}
              </div>
            {% endif %}

            {% if matched_conditions %}
              <div>
                <strong style="color: #3182ce;">ğŸ¤ ãƒãƒƒãƒã—ãŸæ¡ä»¶ãƒ»å¾…é‡:</strong><br>
                {% for tag in matched_conditions %}
                  <span style="display: inline-block; background: #fff; border: 1px solid #63b3ed; color: #2b6cb0; padding: 2px 8px; border-radius: 15px; font-size: 0.85rem; margin: 2px;">
                    {{ tag }}
                  </span>
                {% endfor %}
              </div>
            {% endif %}
            
          </div>
        {% endif %}
    
    {% if user.student %} 
      <div class="action-box">
        
        {% if is_favorited %}
          <form action="{% url 'companies:remove_favorite' company.pk %}" method="post">
            {% csrf_token %}
            <button type="submit" class="btn-cancel">ãŠæ°—ã«å…¥ã‚Šã‹ã‚‰å‰Šé™¤</button>
          </form>
        {% else %}
          <form action="{% url 'companies:add_favorite' company.pk %}" method="post">
            {% csrf_token %}
            <button type="submit" class="btn-favorite">ãŠæ°—ã«å…¥ã‚Šã«ç™»éŒ²</button>
          </form>
        {% endif %}
        
        {% if existing_chat_room_id %}
          <a href="{% url 'chat:chat_room' existing_chat_room_id %}?next={{ request.path }}" class="btn-chat">ãƒãƒ£ãƒƒãƒˆã‚’ç¶šã‘ã‚‹</a>
        {% elif first_rep_user_id %}
          <a href="{% url 'chat:start_chat' first_rep_user_id %}?next={{ request.path }}" class="btn-chat">ãƒãƒ£ãƒƒãƒˆã‚’é–‹å§‹ã™ã‚‹</a>
        {% else %}
          <p class="no-chat">ï¼ˆãƒãƒ£ãƒƒãƒˆæ‹…å½“è€…ä¸åœ¨ï¼‰</p>
        {% endif %}
      </div>
    {% endif %}
    
    {% if user.teacher %}
      <div class="action-box">
        {% if existing_chat_room_id %}
          <a href="{% url 'chat:chat_room' existing_chat_room_id %}?next={{ request.path }}" class="btn-chat">ãƒãƒ£ãƒƒãƒˆã‚’ç¶šã‘ã‚‹</a>
        {% elif first_rep_user_id %}
          <a href="{% url 'chat:start_chat' first_rep_user_id %}?next={{ request.path }}" class="btn-chat">ã“ã®ä¼æ¥­ã®æ‹…å½“è€…ã¨ãƒãƒ£ãƒƒãƒˆã‚’é–‹å§‹ã™ã‚‹</a>
        {% else %}
          <p class="no-chat">ï¼ˆã“ã®ä¼æ¥­ã«ã¯ãƒãƒ£ãƒƒãƒˆå¯èƒ½ãªæ‹…å½“è€…ãŒã„ã¾ã›ã‚“ï¼‰</p>
        {% endif %}
      </div>
    {% endif %}
    
    <div class="company-detail-page">
      <div class="info-table">
        <table>
          <tr>
            <th>æ¥­ç¨®</th>
            <td>{{ company.industry }}</td>
          </tr>
          <tr>
            <th>äº‹æ¥­å†…å®¹</th>
            <td>{{ company.description | linebreaksbr }}</td>
          </tr>
        </table>
      </div>
    </div>
    
    <hr>
    
    {% if request.GET.next %}
      <a href="{{ request.GET.next }}" class="back-link">â† ãŠæ°—ã«å…¥ã‚Šä¸€è¦§ã«æˆ»ã‚‹</a>
    {% else %}
      <a href="{% url 'companies:list' %}" class="back-link">â† ä¼æ¥­ä¸€è¦§ã«æˆ»ã‚‹</a>
    {% endif %}

  </div>
</div>
{% endblock %}